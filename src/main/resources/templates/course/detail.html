<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="${course.name} + ' ìƒì„¸ ì •ë³´'">ì½”ìŠ¤ ìƒì„¸</title>
    <link rel="stylesheet" href="/css/course/detail.css">

    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f875aaa396a57ff0e17e90cb143352f8&libraries=services"></script>
</head>
<body>
<div class="container">

    <h2><span class="icon">ğŸŒ¿</span><span th:text="${course.name}">ì½”ìŠ¤ëª…</span></h2>

    <ul class="course-detail-list">
        <li><strong>ê±°ë¦¬:</strong> <span th:text="${course.distanceKm} + ' km'"></span></li>
        <li><strong>ì†Œìš”ì‹œê°„:</strong> <span th:text="${#strings.replace(course.duration, 'ì‹œê°„', 'ì‹œê°„ ')}"></span></li>
        <li><strong>ë‚œì´ë„:</strong>
            <span th:text="${course.level == 1 ? 'ì´ˆê¸‰' : (course.level == 2 ? 'ì¤‘ê¸‰' : (course.level == 3 ? 'ê³ ê¸‰' : 'ì•Œ ìˆ˜ ì—†ìŒ'))}"></span>
        </li>
        <li><strong>ì°œ ê°œìˆ˜:</strong> <span th:text="${course.favoriteCount} + 'ê°œ'"></span></li>
    </ul>

    <!-- ì¹´ì¹´ì˜¤ë§µ ê²½ë¡œ ë³´ê¸° ë²„íŠ¼ -->
    <form onsubmit="return openKakaoMapRoute();">
        <button type="submit" class="kakao-map-btn">ğŸ—ºï¸ ì¹´ì¹´ì˜¤ë§µ ê²½ë¡œ ë³´ê¸°</button>
    </form>

    <!-- ì°œ ë²„íŠ¼ -->
    <div class="action-row">
        <div sec:authorize="isAuthenticated()">
            <form th:if="${!course.favorite}" th:action="@{'/courses/' + ${course.id} + '/favorite'}" method="post">
                <button type="submit" class="action-btn primary">â¤ï¸ ì°œí•˜ê¸°</button>
            </form>
            <form th:if="${course.favorite}" th:action="@{'/courses/' + ${course.id} + '/unfavorite'}" method="post">
                <button type="submit" class="action-btn logout">ğŸ’” ì°œ í•´ì œ</button>
            </form>
        </div>
        <div sec:authorize="isAnonymous()">
            <form onsubmit="return handleLoginRequired()">
                <button type="submit" class="action-btn primary">â¤ï¸ ì°œí•˜ê¸°</button>
            </form>
        </div>
    </div>

    <a href="/courses" class="back-link">â† ì‚°ì±… ì½”ìŠ¤ ëª©ë¡</a>
    <a href="/mypage" class="back-link">â† ë§ˆì´í˜ì´ì§€</a>
</div>

<!-- ì¹´ì¹´ì˜¤ë§µ ë§í¬ JS -->
<script th:inline="javascript">
    function handleLoginRequired() {
        if (confirm("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.\në¡œê·¸ì¸ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            window.location.href = '/login?redirect=' + encodeURIComponent('[[${course.id}]]');
        }
        return false;
    }

    function openKakaoMapRoute() {
        const pathPoints = [[${course.paths}]];
        if (!pathPoints || pathPoints.length < 2) {
            alert("ê²½ë¡œ ì •ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            return false;
        }

        const start = pathPoints[0];
        const end = pathPoints[pathPoints.length - 1];

        const url = `https://map.kakao.com/link/by/walk/${encodeURIComponent('ë„ì°©ì§€')},${end.latitude},${end.longitude}` +
            `/${encodeURIComponent('ì¶œë°œì§€')},${start.latitude},${start.longitude}`;

        window.open(url, "_blank");
        return false;
    }
</script>

</body>
</html>
